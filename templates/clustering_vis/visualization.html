<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.79.0">
    <title>Keyword Data Tools</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/dashboard/">

    {% load static %}


    <!-- Bootstrap core CSS -->
<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }

      form {
        display: flex;
        flex-flow: column;
        height: 100%;
        width: 100%;
      }

      /* This is the default state */
      .custom-radio-positive .custom-control-label-positive::before {
        background-color: #c4f7ba;  /* pale green */
      }

      /* This is the checked state */
      .custom-radio-positive .custom-control-input-positive:checked~.custom-control-label-positive::before,
      .custom-radio-positive .custom-control-input-positive:checked~.custom-control-label-positive::after {
          background-color: #25e000;  /* green */
          /* border-radius: 50%; */
      }

      /* This is the default state */
      .custom-radio-negative .custom-control-label-negative::before {
        background-color: #ffbaba;  /* pale red */
      }

      /* This is the checked state */
      .custom-radio-negative .custom-control-input-negative:checked~.custom-control-label-negative::before,
      .custom-radio-negative .custom-control-input-negative:checked~.custom-control-label-negative::after {
          background-color: #db0000;  /* red */
          /* border-radius: 50%; */
      }


      .node {
        cursor: pointer;
      }

      .node circle {
        fill: #fff;
        stroke: steelblue;
        stroke-width: 3px;
      }

      .node text {
        font: 12px sans-serif;
      }

      .link {
        fill: none;
        stroke: #ccc;
        stroke-width: 2px;
      }


    </style>

    
    <!-- Custom styles for this template -->
    <link href="{% static 'dashboard.css' %}" rel="stylesheet">
  </head>
  <body>
    
<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">Keyword Data Tools</a>
  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <form method="post" action="/search/" target="_blank">
    {% csrf_token %}
    <input class="form-control form-control-dark w-100" type="text" placeholder="Search Keywords" aria-label="Search" name="search_input" id="search_input">
  </form>
  <ul class="navbar-nav px-3">
    <li class="nav-item text-nowrap">
      {% if user.is_authenticated %}
      <a class="nav-link" href="{% url 'logout' %}" style="text-decoration: none; color: white;">Sign out</a>
      {% else %}
      <a href="{% url 'login' %}" style="text-decoration: none; color: white;">Login</a>
      {% endif %}
    </li>
  </ul>
</header>

<div class="container-fluid">
  <div class="row">

    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="{% url 'home' %}">
              <span data-feather="home"></span>
              Home
            </a>
          </li>
          {% if user.is_superuser %}
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="{% url 'admin_tool' %}">
              <span data-feather="sliders"></span>
              Admin Tool
            </a>
          </li>
          {% endif %}
          <li class="nav-item">
            <a class="nav-link" href="{% url 'keyword_pages' %}">
              <span data-feather="file"></span>
              Keyword Pages
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'find_similar_keyword_default' %}">
              <span data-feather="user-check"></span>
              Find Similar Keyword Tool
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'verify_relationship_tool' %}">
              <span data-feather="user-check"></span>
              Verify Keyword Relationship Tool
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'verify_domain_tool' %}">
              <span data-feather="user-check"></span>
              Verify Domain Tool
            </a>
          </li>
          <!-- <li class="nav-item">
            <a class="nav-link" href="{% url 'verify_definition_tool' %}">
              <span data-feather="user-check"></span>
              Verify Definition Tool
            </a>
          </li> -->
        </ul>
      </div>
    </nav>

    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div style="padding-bottom: 25px;padding-top: 15px;">
        <h3 style="display: inline-block;margin: 10px;">Clustering Visualization</h3>
      </div>

      <input type="radio" id="cluster_button" name="option" value="cluster_button" checked onclick="display_cluster()">
      <label for="male">Cluster Visualization</label><br>
      <input type="radio" id="dendogram_button" name="option" value="dendogram_button" onclick="display_dendogram()">
      <label for="female">Dendogram Visualization</label><br>


      <div id="my_dataviz" hidden></div>

      <div class="input-group" id="cluster_input_div">
        <div class="form-outline">
          <div class="input-group mb-3">
            <form method="post" action="/clustering_vis/iteration_input/" style="width: 100%;">
              {% csrf_token %}
              <label for="iter_count"># Iterations of Hierarchical Clustering</label>
              <input type="range" id="iter_count" name="iter_count" min="0" onchange="updateTextInput(this.value);">
              <input type="text" id="textInput" value="" onchange="updateRangeInput(this.value);">
              <p id="grab_num_iters" hidden>{{ num_iters }}</p>
              <input type="submit">
            </form>
          </div>
        </div>
      </div>


      <div class="table-responsive" id="cluster_table">
        <table class="table table-striped table-sm" id="mainTable">
          <thead>
            <tr>
              <th>Cluster #</th>
              <th>Keywords</th>
            </tr>
          </thead>
          <tbody id="list_matched">

          </tbody>
        </table>

        <div class="d-flex justify-content-center text-primary" id="loading">
          <div class="spinner-border" role="status">
            <span class="sr-only"></span>
          </div>
        </div>
      </div>

      <div id="my_dataviz" hidden></div>

      <p id="grab_output" hidden>{{ output }}</p>
      <p id="grab_max" hidden>{{ max }}</p>
      <p id="grab_dendogram_data hidden">{{dendogram_data}}</p>

    </main>
  </div>
</div>

  <!-- load the d3.js library -->	
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>

    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous"></script><script src="{% static 'dashboard.js' %}"></script>
    <script>

// set the dimensions and margins of the graph
var width = 460
var height = 460

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(40,0)");  // bit of margin on the left = 40

// read json data
alert("hit");
// d3.json("{% static 'd3-dendrogram.json' %}", function(data) {
  d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/data_dendrogram.json", function(data) {

  alert("hit");
  // Create the cluster layout:
  var cluster = d3.cluster()
    .size([height, width - 100]);  // 100 is the margin I will have on the right side

  // Give the data to this cluster layout:
  var root = d3.hierarchy(data, function(d) {
      return d.children;
  });
  cluster(root);
  alert(root);


  // Add the links between nodes:
  svg.selectAll('path')
    .data( root.descendants().slice(1) )
    .enter()
    .append('path')
    .attr("d", function(d) {
        return "M" + d.y + "," + d.x
                + "C" + (d.parent.y + 50) + "," + d.x
                + " " + (d.parent.y + 150) + "," + d.parent.x // 50 and 150 are coordinates of inflexion, play with it to change links shape
                + " " + d.parent.y + "," + d.parent.x;
              })
    .style("fill", 'none')
    .attr("stroke", '#ccc')


  // Add a circle for each node.
  svg.selectAll("g")
      .data(root.descendants())
      .enter()
      .append("g")
      .attr("transform", function(d) {
          return "translate(" + d.y + "," + d.x + ")"
      })
      .append("circle")
        .attr("r", 7)
        .style("fill", "#69b3a2")
        .attr("stroke", "black")
        .style("stroke-width", 2)

})


      function display_cluster() {
        document.getElementById("cluster_input_div").hidden = false;
        document.getElementById("cluster_table").hidden = false;
        document.getElementById("my_dataviz").hidden = true;
      }

      function display_dendogram() {
        document.getElementById("cluster_input_div").hidden = true;
        document.getElementById("cluster_table").hidden = true;
        document.getElementById("my_dataviz").hidden = false;
      }

      function fill_table() {
        var keywords_str = document.getElementById("grab_output").innerHTML;
        var keywords_str_res = keywords_str.split("|");

        var html = ""

        for (var i = 0; i < keywords_str_res.length-1; i++) {
          var record = "";

          record = record.concat("<tr>");
          
          record = record.concat("<td>");
          record = record.concat(i.toString());
          record = record.concat("</td>");

          record = record.concat("<td>");
          record = record.concat(keywords_str_res[i]);
          record = record.concat("</td>");

          record = record.concat("</tr>");

          // table_map.set(keywords_str_res[i], record);
          html = html.concat(record);

        }
        document.getElementById("list_matched").innerHTML = html;
        document.getElementById("loading").innerHTML = "";

        document.getElementById("iter_count").max = parseInt(document.getElementById("grab_max").innerHTML);
        document.getElementById("iter_count").value = parseInt(document.getElementById("grab_num_iters").innerHTML);

      }

      function updateTextInput(val) {
          document.getElementById('textInput').value=val; 
        }

        function updateRangeInput(val) {
          document.getElementById('iter_count').value=val; 
        }

      window.onload = function() {
        fill_table();
        document.getElementById('textInput').value=parseInt(document.getElementById("grab_num_iters").innerHTML);
      }

    </script>
  </body>
</html>
